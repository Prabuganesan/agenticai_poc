<!DOCTYPE html>
<html lang="en" class="gitbook-root">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autonomous Documentation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="src/assets/favicon.ico">
    <style>
        :root {
            --color-primary: #3b82f6;
            --color-primary-dark: #2563eb;
            --color-text: #0f172a;
            --color-text-light: #64748b;
            --color-border: #e2e8f0;
            --color-bg: #ffffff;
            --color-bg-secondary: #f8fafc;
            --color-sidebar-bg: #f8fafc;
            --sidebar-width: 280px;
            --toc-width: 240px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 16px;
            line-height: 1.6;
            color: var(--color-text);
            background: var(--color-bg);
            display: flex;
        }

        /* Sidebar */
        .gitbook-sidebar {
            width: var(--sidebar-width);
            background: var(--color-sidebar-bg);
            border-right: 1px solid var(--color-border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .gitbook-sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid var(--color-border);
        }

        .gitbook-logo {
            font-size: 16px;
            font-weight: 600;
            color: var(--color-text);
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .gitbook-logo-icon {
            font-size: 22px;
        }

        .gitbook-sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 12px 0;
        }

        .gitbook-nav-group {
            margin-bottom: 2px;
        }

        .gitbook-nav-header {
            padding: 8px 20px;
            font-size: 14px;
            font-weight: 600;
            color: var(--color-text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background-color 0.15s ease;
            user-select: none;
        }

        .gitbook-nav-header:hover {
            background: rgba(0, 0, 0, 0.03);
        }

        .gitbook-nav-chevron {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: var(--color-text-light);
            transition: transform 0.2s ease;
        }

        .gitbook-nav-header.expanded .gitbook-nav-chevron {
            transform: rotate(90deg);
        }

        .gitbook-nav-items {
            display: none;
        }

        .gitbook-nav-items.show {
            display: block;
        }

        .gitbook-nav-link {
            display: block;
            padding: 6px 20px 6px 36px;
            font-size: 14px;
            color: var(--color-text-light);
            text-decoration: none;
            transition: all 0.15s ease;
            border-left: 2px solid transparent;
            margin-left: 18px;
        }

        .gitbook-nav-link:hover {
            color: var(--color-text);
            background: rgba(0, 0, 0, 0.02);
        }

        .gitbook-nav-link.active {
            color: var(--color-primary);
            background: rgba(59, 130, 246, 0.08);
            border-left-color: var(--color-primary);
            font-weight: 500;
        }

        .gitbook-nav-link.nested {
            padding-left: 52px;
        }

        /* Main Content */
        .gitbook-main {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .gitbook-page {
            flex: 1;
            overflow-y: auto;
            background: var(--color-bg);
        }

        .gitbook-page-inner {
            max-width: 880px;
            margin: 0 auto;
            padding: 64px 48px 120px;
        }

        .gitbook-page-title {
            font-size: 40px;
            font-weight: 700;
            line-height: 1.2;
            color: var(--color-text);
            margin-bottom: 32px;
        }

        .gitbook-content {
            font-size: 16px;
            line-height: 1.75;
            color: var(--color-text);
        }

        .gitbook-content h1 {
            font-size: 36px;
            font-weight: 700;
            line-height: 1.2;
            margin-top: 48px;
            margin-bottom: 24px;
            color: var(--color-text);
        }

        .gitbook-content h1:first-child {
            margin-top: 0;
        }

        .gitbook-content h2 {
            font-size: 28px;
            font-weight: 600;
            line-height: 1.3;
            margin-top: 40px;
            margin-bottom: 20px;
            color: var(--color-text);
        }

        .gitbook-content h3 {
            font-size: 22px;
            font-weight: 600;
            line-height: 1.4;
            margin-top: 32px;
            margin-bottom: 16px;
            color: var(--color-text);
        }

        .gitbook-content h4 {
            font-size: 18px;
            font-weight: 600;
            margin-top: 24px;
            margin-bottom: 12px;
            color: var(--color-text);
        }

        .gitbook-content p {
            margin-bottom: 20px;
        }

        .gitbook-content a {
            color: var(--color-primary);
            text-decoration: none;
            transition: color 0.15s ease;
        }

        .gitbook-content a:hover {
            color: var(--color-primary-dark);
            text-decoration: underline;
        }

        .gitbook-content code {
            background: #f1f5f9;
            color: #e11d48;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'SF Mono', Monaco, Consolas, monospace;
            font-size: 0.9em;
        }

        .gitbook-content pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 24px 0;
            line-height: 1.6;
        }

        .gitbook-content pre code {
            background: none;
            color: inherit;
            padding: 0;
            font-size: 14px;
        }

        .gitbook-content ul,
        .gitbook-content ol {
            margin-bottom: 20px;
            padding-left: 28px;
        }

        .gitbook-content th {
            background: var(--color-bg-secondary);
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            border: 1px solid var(--color-border);
        }

        .gitbook-content td {
            padding: 12px 16px;
            border: 1px solid var(--color-border);
        }

        .gitbook-content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 24px 0;
        }

        .gitbook-content hr {
            border: none;
            border-top: 1px solid var(--color-border);
            margin: 32px 0;
        }

        /* Table of Contents */
        .gitbook-toc {
            width: var(--toc-width);
            flex-shrink: 0;
            border-left: 1px solid var(--color-border);
            overflow-y: auto;
            padding: 64px 24px;
            background: var(--color-bg);
        }

        .gitbook-toc-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--color-text-light);
            margin-bottom: 16px;
        }

        .gitbook-toc-list {
            list-style: none;
        }

        .gitbook-toc-item {
            margin-bottom: 10px;
        }

        .gitbook-toc-link {
            display: block;
            font-size: 13px;
            color: var(--color-text-light);
            text-decoration: none;
            padding: 4px 0 4px 12px;
            border-left: 2px solid transparent;
            transition: all 0.15s ease;
            line-height: 1.5;
        }

        .gitbook-toc-link:hover {
            color: var(--color-text);
            border-left-color: var(--color-border);
        }

        .gitbook-toc-link.active {
            color: var(--color-primary);
            border-left-color: var(--color-primary);
            font-weight: 500;
        }

        .gitbook-toc-link.level-2 {
            padding-left: 12px;
        }

        .gitbook-toc-link.level-3 {
            padding-left: 24px;
            font-size: 12px;
        }

        /* Loading & Error States */
        .gitbook-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            color: var(--color-text-light);
        }

        .gitbook-error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 20px;
            color: #991b1b;
            margin: 24px 0;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .gitbook-toc {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .gitbook-sidebar {
                position: fixed;
                left: -280px;
                height: 100vh;
                z-index: 100;
                transition: left 0.3s ease;
            }

            .gitbook-page-inner {
                padding: 32px 24px 80px;
            }

            .gitbook-page-title {
                font-size: 32px;
            }
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <aside class="gitbook-sidebar">
        <div class="gitbook-sidebar-header">
            <a href="#" class="gitbook-logo">
                <span class="gitbook-logo-icon">ðŸ“š</span>
                <span>Autonomous Docs</span>
            </a>
        </div>
        <nav class="gitbook-sidebar-content" id="sidebarNav"></nav>
    </aside>

    <!-- Main Content -->
    <main class="gitbook-main">
        <div class="gitbook-page">
            <div class="gitbook-page-inner">
                <h1 class="gitbook-page-title" id="pageTitle" style="display: none;"></h1>
                <div class="gitbook-content" id="pageContent">
                    <div class="gitbook-loading">Loading documentation...</div>
                </div>
            </div>
        </div>

        <!-- Table of Contents -->
        <aside class="gitbook-toc" id="tocSidebar">
            <div class="gitbook-toc-title">On This Page</div>
            <ul class="gitbook-toc-list" id="tocList"></ul>
        </aside>
    </main>
    <script>
        function getDocsBasePath() {
            const path = window.location.pathname;
            const docsIndex = path.indexOf('/docs/');
            if (docsIndex !== -1) {
                return path.substring(0, docsIndex + 6);
            }
            return '/autonomous/docs/';
        }

        const basePath = getDocsBasePath();
        const contextPath = basePath.endsWith('/docs/') ? basePath.slice(0, -6) : basePath;
        const API_ENDPOINT = window.location.origin + contextPath + '/api/v1/docs/convertMdtohtml';

        // Build sidebar navigation
        function buildSidebarNav(items, container) {
            items.forEach(item => {
                if (item.children && item.children.length > 0) {
                    const groupDiv = document.createElement('div');
                    groupDiv.className = 'gitbook-nav-group';

                    const headerDiv = document.createElement('div');
                    headerDiv.className = 'gitbook-nav-header';

                    const titleSpan = document.createElement('span');
                    titleSpan.textContent = item.title;

                    const chevronSpan = document.createElement('span');
                    chevronSpan.className = 'gitbook-nav-chevron';
                    chevronSpan.textContent = 'â–¸';

                    headerDiv.appendChild(titleSpan);
                    headerDiv.appendChild(chevronSpan);

                    const itemsDiv = document.createElement('div');
                    itemsDiv.className = 'gitbook-nav-items';

                    buildNavItems(item.children, itemsDiv);

                    headerDiv.addEventListener('click', (e) => {
                        if (e.target === chevronSpan || e.target.classList.contains('gitbook-nav-chevron')) {
                            headerDiv.classList.toggle('expanded');
                            itemsDiv.classList.toggle('show');
                            e.stopPropagation();
                            return;
                        }

                        if (item.path) {
                            loadPage(item.path, item.title);
                            headerDiv.classList.add('expanded');
                            itemsDiv.classList.add('show');
                        } else {
                            headerDiv.classList.toggle('expanded');
                            itemsDiv.classList.toggle('show');
                        }
                    });

                    groupDiv.appendChild(headerDiv);
                    groupDiv.appendChild(itemsDiv);
                    container.appendChild(groupDiv);
                } else if (item.path) {
                    const link = document.createElement('div');
                    link.className = 'gitbook-nav-header';
                    link.style.cursor = 'pointer';
                    link.innerHTML = `<span>${item.title}</span>`;
                    link.addEventListener('click', () => {
                        loadPage(item.path, item.title);
                    });
                    container.appendChild(link);
                }
            });
        }

        function buildNavItems(items, container, nested = false) {
            items.forEach(item => {
                if (item.path) {
                    const link = document.createElement('a');
                    link.className = 'gitbook-nav-link' + (nested ? ' nested' : '');
                    link.textContent = item.title;
                    link.href = '#';
                    link.dataset.path = item.path;
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        loadPage(item.path, item.title);
                    });
                    container.appendChild(link);
                }

                if (item.children) {
                    buildNavItems(item.children, container, true);
                }
            });
        }

        // Load navigation
        async function loadNav() {
            try {
                const res = await fetch(basePath + 'navigationConfig.json', { cache: 'no-store' });
                const data = await res.json();
                const nav = data.nav || [];
                const sidebar = document.getElementById('sidebarNav');
                sidebar.innerHTML = '';
                buildSidebarNav(nav, sidebar);
                return nav;
            } catch (err) {
                console.error('Failed to load navigation:', err);
                return [];
            }
        }

        // Build table of contents
        function buildTableOfContents(html) {
            const tocList = document.getElementById('tocList');
            tocList.innerHTML = '';

            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = html;

            const headings = tempDiv.querySelectorAll('h1, h2, h3');

            if (headings.length === 0) {
                document.getElementById('tocSidebar').style.display = 'none';
                return html;
            }

            document.getElementById('tocSidebar').style.display = 'block';

            headings.forEach((heading, index) => {
                const level = parseInt(heading.tagName.substring(1));

                // Create a slug from the heading text
                const headingText = heading.textContent.replace(/^#+\s*/, '');
                const slug = headingText
                    .toLowerCase()
                    .replace(/[^\w\s-]/g, '') // Remove special characters
                    .replace(/\s+/g, '-')      // Replace spaces with hyphens
                    .replace(/-+/g, '-')       // Replace multiple hyphens with single hyphen
                    .trim();

                // Use the slug as ID, or fallback to heading-N if slug is empty
                const id = slug || `heading-${index}`;
                heading.id = id;

                const li = document.createElement('li');
                li.className = 'gitbook-toc-item';

                const link = document.createElement('a');
                link.className = `gitbook-toc-link level-${level}`;
                link.href = `#${id}`;
                link.textContent = headingText;
                link.addEventListener('click', (e) => {
                    e.preventDefault();

                    // Update URL with anchor
                    const currentUrl = window.location.pathname;
                    const newUrl = currentUrl + '#' + id;
                    history.replaceState(history.state, '', newUrl);

                    // Scroll to element
                    document.getElementById(id)?.scrollIntoView({ behavior: 'smooth' });
                    document.querySelectorAll('.gitbook-toc-link').forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                });

                li.appendChild(link);
                tocList.appendChild(li);
            });

            return tempDiv.innerHTML;
        }

        // Helper to find path in config
        function findPathByUrl(items, urlPath) {
            for (const item of items) {
                if (item.path) {
                    let clean = item.path.replace(/^src\//, '').replace(/\.md$/, '');
                    if (clean.endsWith('/README')) {
                        clean = clean.substring(0, clean.length - 7);
                    } else if (clean === 'README') {
                        clean = '';
                    }

                    // Normalize urlPath (remove trailing slash)
                    let normalizedUrl = urlPath;
                    if (normalizedUrl.endsWith('/')) normalizedUrl = normalizedUrl.slice(0, -1);

                    if (clean === normalizedUrl) {
                        return item.path;
                    }
                }
                if (item.children) {
                    const found = findPathByUrl(item.children, urlPath);
                    if (found) return found;
                }
            }
            return null;
        }

        // Setup link click handlers for content
        function setupContentLinks(currentPath) {
            const content = document.getElementById('pageContent');

            content.addEventListener('click', (e) => {
                const link = e.target.closest('a');
                if (!link) return;

                const href = link.getAttribute('href');
                if (!href) return;

                // Skip external links
                if (href.startsWith('http://') || href.startsWith('https://') || href.startsWith('//')) {
                    return;
                }

                // Skip anchor-only links (same page)
                if (href.startsWith('#')) {
                    return;
                }

                // Handle relative .md links
                if (href.endsWith('.md') || href.includes('.md#')) {
                    e.preventDefault();

                    // Extract anchor if present
                    let linkPath = href;
                    let anchor = null;
                    if (href.includes('#')) {
                        const parts = href.split('#');
                        linkPath = parts[0];
                        anchor = parts[1];
                    }

                    // Resolve relative path based on current document path
                    let resolvedPath;
                    if (linkPath.startsWith('../')) {
                        // Go up one level from current path
                        const currentDir = currentPath.substring(0, currentPath.lastIndexOf('/'));
                        const parentDir = currentDir.substring(0, currentDir.lastIndexOf('/'));
                        resolvedPath = parentDir + '/' + linkPath.substring(3);
                    } else if (linkPath.startsWith('./')) {
                        // Same directory
                        const currentDir = currentPath.substring(0, currentPath.lastIndexOf('/'));
                        resolvedPath = currentDir + '/' + linkPath.substring(2);
                    } else {
                        // Relative to current directory
                        const currentDir = currentPath.substring(0, currentPath.lastIndexOf('/'));
                        resolvedPath = currentDir + '/' + linkPath;
                    }

                    loadPage(resolvedPath, 'Documentation', anchor);
                }
            });
        }

        // Load page
        async function loadPage(path, title, anchor = null) {
            const content = document.getElementById('pageContent');
            const titleEl = document.getElementById('pageTitle');

            content.innerHTML = '<div class="gitbook-loading">Loading...</div>';
            titleEl.style.display = 'none';

            try {
                const res = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ path })
                });

                if (!res.ok) throw new Error('Failed to load: ' + res.status);

                const html = await res.text();
                const htmlWithIds = buildTableOfContents(html);

                // Show title if no h1 in content
                if (!html.trim().startsWith('<h1')) {
                    titleEl.textContent = title;
                    titleEl.style.display = 'block';
                }

                content.innerHTML = htmlWithIds;

                // Update active states
                document.querySelectorAll('.gitbook-nav-link').forEach(item => {
                    item.classList.toggle('active', item.dataset.path === path);
                });

                // Expand parent
                const activeItem = document.querySelector('.gitbook-nav-link.active');
                if (activeItem) {
                    const parent = activeItem.closest('.gitbook-nav-items');
                    if (parent) {
                        parent.classList.add('show');
                        parent.previousElementSibling?.classList.add('expanded');
                    }
                }

                // Construct clean URL - Remove src/ prefix and .md suffix
                let cleanPath = path.replace(/^src\//, '').replace(/\.md$/, '');
                if (cleanPath.endsWith('/README')) {
                    cleanPath = cleanPath.substring(0, cleanPath.length - 7);
                } else if (cleanPath === 'README') {
                    cleanPath = '';
                }

                // Ensure we have the correct base path
                const currentPath = window.location.pathname;
                const docsIndex = currentPath.indexOf('/docs/');
                let basePathForUrl = '/docs/';
                if (docsIndex !== -1) {
                    basePathForUrl = currentPath.substring(0, docsIndex + 6);
                }

                const newUrl = basePathForUrl + cleanPath + (anchor ? '#' + anchor : '');

                history.pushState({ path, title }, '', newUrl);
                if (anchor) {
                    // Try to scroll to anchor
                    setTimeout(() => {
                        const el = document.getElementById(anchor) || document.getElementsByName(anchor)[0];
                        if (el) {
                            el.scrollIntoView({ behavior: 'smooth' });
                        } else {
                            document.querySelector('.gitbook-page').scrollTop = 0;
                        }
                    }, 100);
                } else {
                    document.querySelector('.gitbook-page').scrollTop = 0;
                }

                // Setup link handlers for the new content
                setupContentLinks(path);
            } catch (err) {
                content.innerHTML = `<div class="gitbook-error"><strong>Error:</strong> ${err.message}</div>`;
            }
        }

        // Browser navigation
        window.addEventListener('popstate', (ev) => {
            if (ev.state?.path) loadPage(ev.state.path, ev.state.title || 'Documentation');
        });

        // Initialize
        async function init() {
            const navData = await loadNav();
            // 1. Check for hash-based navigation (legacy or internal links)
            if (location.hash && location.hash.length > 1 && !location.hash.startsWith('#id-') && !location.hash.startsWith('#heading-')) {
                // If it's a path hash (starts with # but not an anchor id), treat it as a page path
                // e.g. #integrations/langchain/tools/gmail
                const hashPath = decodeURIComponent(location.hash.slice(1));
                // If it doesn't look like an anchor, load it as a page
                if (hashPath.includes('/')) {
                    loadPage(hashPath, 'Documentation');
                    return;
                }
            }

            // 2. Check for URL path-based navigation
            const path = window.location.pathname;
            // Check for /docs/ in the path
            const docsIndex = path.indexOf('/docs/');

            if (docsIndex !== -1) {
                // Extract path after /docs/
                let docPath = path.substring(docsIndex + 6); // 6 is length of '/docs/'

                // Remove trailing slash if present
                if (docPath.endsWith('/')) {
                    docPath = docPath.slice(0, -1);
                }

                if (docPath && docPath.length > 0) {
                    // Try to resolve path from config first
                    const resolvedPath = findPathByUrl(navData, docPath);
                    if (resolvedPath) {
                        // Check for anchor in hash
                        let anchor = null;
                        if (location.hash && (location.hash.startsWith('#id-') || location.hash.startsWith('#heading-') || !location.hash.includes('/'))) {
                            anchor = location.hash.slice(1);
                        }
                        loadPage(resolvedPath, 'Documentation', anchor);
                        return;
                    }

                    // Fallback: Construct the file path: src/ + docPath + .md
                    // Handle cases where docPath might already start with src/ (unlikely but possible)
                    let filePath = docPath;
                    if (!filePath.startsWith('src/')) {
                        filePath = 'src/' + filePath;
                    }
                    if (!filePath.endsWith('.md')) {
                        filePath = filePath + '.md';
                    }

                    // Check for anchor in hash
                    let anchor = null;
                    if (location.hash && (location.hash.startsWith('#id-') || location.hash.startsWith('#heading-') || !location.hash.includes('/'))) {
                        anchor = location.hash.slice(1);
                    }

                    loadPage(filePath, 'Documentation', anchor);
                    return;
                }
            }

            // 3. Fallback to default
            loadPage('src/README.md', 'Introduction');
        }


        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>